{% extends 'base.html' %}

{% block content %}
<main style="margin-top: 100px;">
    <div class="limiter">
        <div class="container-login100">
            <div class="wrap-login100">
                <form class="login100-form validate-form" action="/modificarAlergenos" method="post" novalidate>
                    <span class="login100-form-title">
                        Modificar Alergias
                    </span>
                    <p>Selecciona los alimentos a los que tienes alergia y proporciona los detalles.</p>

                    <div id="alergenos-container">
                        {% for alergeno in alergenos %}
                        <div class="alergeno-box">
                            <label for="alimento-{{ loop.index }}">Alimento:</label>
                            <select name="alimento" id="alimento-{{ loop.index }}" required>
                                <option value="" disabled>Selecciona un alimento</option>
                                {% for alimento in alimentos %}
                                    <option value="{{ alimento.id_alimento }}" {% if alergeno.id_alimento == alimento.id_alimento %}selected{% endif %}>{{ alimento.nombreAlimento }}</option>
                                {% endfor %}
                            </select>

                            <label for="gravedad-{{ loop.index }}">Gravedad:</label>
                            <input type="text" name="gravedad" id="gravedad-{{ loop.index }}" value="{{ alergeno.gravedad }}" required>

                            <label for="sintomas-{{ loop.index }}">Síntomas:</label>
                            <input type="text" name="sintomas" id="sintomas-{{ loop.index }}" value="{{ alergeno.sintomas }}" required>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div class="button-container">
                        <button type="button" class="add-button" onclick="addAlergenoBox()">
                            <img src="{{ url_for('static', filename='images/icons/iconoMas.png') }}" alt="Añadir Alergeno">
                        </button>
                    </div>

                    <div class="button-container">
                        <button class="submit-button">
                            Modificar Alergias
                        </button>
                    </div>

                    <div>
                        {% with messages = get_flashed_messages() %}
                            {% if messages %}
                                <ul>
                                    {% for message in messages %}
                                        <li>{{ message }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        {% endwith %}
                    </div>
                </form>
            </div>
        </div>
    </div>
</main>

<style>
    .alergeno-box {
        border: 1px solid #ccc;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 5px;
    }

    .alergeno-box label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }

    .alergeno-box select, .alergeno-box input {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    .button-container {
        text-align: center;
        margin-top: 20px;
    }

    .add-button, .submit-button {
        background-color: #4CAF50;
        color: white;
        border: none;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 12px;
    }

    .add-button img {
        width: 20px;
        height: 20px;
    }

    .add-button:hover, .submit-button:hover {
        background-color: #45a049;
    }
</style>

<script>
    function addAlergenoBox() {
        const container = document.getElementById('alergenos-container');
        const newBox = document.createElement('div');
        newBox.classList.add('alergeno-box');
        newBox.innerHTML = `
            <label for="alimento">Alimento:</label>
            <select name="alimento" required>
                <option value="" disabled selected>Selecciona un alimento</option>
                {% for alimento in alimentos %}
                    <option value="{{ alimento.id_alimento }}">{{ alimento.nombreAlimento }}</option>
                {% endfor %}
            </select>

            <label for="gravedad">Gravedad:</label>
            <input type="text" name="gravedad" placeholder="Gravedad" required>

            <label for="sintomas">Síntomas:</label>
            <input type="text" name="sintomas" placeholder="Síntomas" required>
        `;
        container.appendChild(newBox);
    }
</script>

<script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}
