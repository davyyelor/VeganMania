{% extends 'base.html' %}

{% block content %}
<style>
    .soon-to-be-out {
        opacity: 0.7;
        vertical-align: middle;
    }
    .out-of-season {
        filter: grayscale(100%);
    }
    .product-description {
        display: none;
        position: absolute;
        background-color: #fff;
        border: 1px solid #ccc;
        padding: 10px;
        z-index: 1;
    }
    .month-filter {
        list-style: none;
        padding: 0;
        display: flex;
        justify-content: space-around;
        margin-bottom: 20px;
    }
    .month-filter .month {
        cursor: pointer;
    }
    .month-filter .active {
        font-weight: bold;
        color: blue;
    }
</style>

<div class="container" style="margin-top: 100px;">
    <div class="row">
        <ul class="month-filter">
            {% for month in ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'] %}
                <li>
                    <span class="month text-center" data-month="{{ month }}" onclick="changeMonth('{{ month }}')">{{ month }}</span>
                </li>
            {% endfor %}
        </ul>
    </div>

    <div class="row">
        <h2>Producto de temporada</h2>
        <div class="col-md-6">
            <img src="../static/images/icons/sand-clock-time-svgrepo-com.svg" alt="Producto entrando o saliendo de temporada" style="width: 5%; vertical-align: middle;">
            <p style="display: inline-block; vertical-align: middle;">Producto entrando o saliendo de temporada</p>
        </div>
    </div>

    <div class="row" id="products-container">
        <!-- Productos en temporada -->
        {% set index = 0 %}
        {% for product in in_season %}
            <div class="col-md-4 text-center">
                <div class="product-container">
                    <img src="../static/images/products/{{ product[6] }}" class="img-fluid" alt="{{ product[1] }}" onclick="toggleDescription(this)">
                    <div class="product-description">{{ product[5] }}</div>
                </div>
                <p>{{ product[1] }}</p>
            </div>
            {% set index = index + 1 %}
            {% if index % 3 == 0 %}
                </div>
                <div class="row">
            {% endif %}
        {% endfor %}

        <!-- Productos empezando temporada -->
        {% for product in start_of_season %}
            <div class="col-md-4 text-center">
                <div class="product-container">
                    <img src="../static/images/products/{{ product[6] }}" class="img-fluid soon-to-be-out" alt="{{ product[1] }}" onclick="toggleDescription(this)">
                    <div class="product-description">{{ product[5] }}</div>
                </div>
                <p>{{ product[1] }}</p>
                <img src="../static/images/icons/sand-clock-time-svgrepo-com.svg" style="width: 10%;">
            </div>
            {% set index = index + 1 %}
            {% if index % 3 == 0 %}
                </div>
                <div class="row">
            {% endif %}
        {% endfor %}
    </div>

    <h2>Fuera de Temporada</h2>
    <div class="row">
        {% for product in out_of_season %}
        <div class="col-md-4 text-center">
            <div class="product-container">
                <img src="../static/images/products/{{ product[6] }}" class="img-fluid out-of-season" alt="{{ product[1] }}" onclick="toggleDescription(this)">
                <div class="product-description">{{ product[5] }}</div>
            </div>
            <p>{{ product[1] }}</p>
        </div>
        {% if loop.index % 3 == 0 %}
    </div>
    <div class="row">
        {% endif %}
        {% endfor %}
    </div>
</div>

<script>
    function toggleDescription(img) {
        var description = img.nextElementSibling;
        if (description.style.display === "none") {
            description.style.display = "block";
        } else {
            description.style.display = "none";
        }
    }

    function changeMonth(month) {
        const url = new URL(window.location.href);
        url.searchParams.set('mes', month);
        window.location.href = url.toString();
    }

    document.addEventListener('DOMContentLoaded', function() {
        const currentMonth = "{{ current_month }}";
        document.querySelector(`.month[data-month="${currentMonth}"]`).classList.add('active');
    });
</script>
{% endblock %}
